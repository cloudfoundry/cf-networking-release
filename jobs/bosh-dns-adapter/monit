<% unless p("cf_app_sd_disable") %>
check process bosh-dns-adapter
  with pidfile /var/vcap/sys/run/bpm/bosh-dns-adapter/bosh-dns-adapter.pid
  start program "/var/vcap/jobs/bpm/bin/bpm start bosh-dns-adapter"
  stop program "/var/vcap/jobs/bpm/bin/bpm stop bosh-dns-adapter"
  group vcap

check process bosh-dns-adapter-healthchecker
  with pidfile /var/vcap/sys/run/bpm/bosh-dns-adapter/bosh-dns-adapter-healthchecker.pid
  start program "/var/vcap/jobs/bpm/bin/bpm start bosh-dns-adapter -p bosh-dns-adapter-healthchecker"
  stop program "/var/vcap/jobs/bpm/bin/bpm stop bosh-dns-adapter -p bosh-dns-adapter-healthchecker"
  if 10 restarts within 60 cycles then unmonitor
  if 1 restarts within 1 cycles then exec "/var/vcap/jobs/bosh-dns-adapter/bin/restart-bosh-dns-adapter"
  depends on bosh-dns-adapter
  group vcap
<% end %>
